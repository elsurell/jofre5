"use strict";(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[529],{32529:(e,o,t)=>{t.r(o),t.d(o,{default:()=>D});var i=t(933),a=t(4763),s=t(68720),n=t(58724),m=t(31971),h=t(20360),r=t(69947),d=t(57793),l=t(91524),c=t(90512),u=t(31740),p=t(96783),g=t(43627),w=t(53462),Z=t(69071),b=t(63513),y=t(93955),z=t(7516);class D extends i.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0}}async init(e,o){this.config.enabled=!!e.enabled,this.sweepTilingModule=await o.getModuleBySymbol(a.RR),this.config.enabled&&await this.registerControls(o),this.engine=o,this.cameraModule=await o.getModuleBySymbol(a.kg),this.cameraData=await o.market.waitForData(d.M),this.viewmodeData=await o.market.waitForData(c.O),this.sweepData=await o.market.waitForData(u.Z),this.bindings.push(o.commandBinder.addBinding(b.bj,(async e=>this.zoomBy(e.step))),o.commandBinder.addBinding(b.KB,(async e=>this.zoomBy(-e.step))),o.commandBinder.addBinding(b.ob,(async()=>this.zoomTo(1))),o.commandBinder.addBinding(b.ts,(async e=>this.zoomTo(e.value))),o.commandBinder.addBinding(b._N,(async()=>Promise.resolve(this.getMaxZoomAvailable()))))}async registerControls(e){e.getModuleBySymbol(a.PZ).then((e=>{this.bindings.push(e.registerHandler(s.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(n.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(m.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const o=this.cameraData.zoom();if(!this.validateViewmode())return o;const{currentSweep:t,currentSweepObject:i}=this.sweepData;if(i&&this.checkTilingZoomLevels(e,i),(e=(0,p.uZ)(e,Z.X.minZoom,this.getMaxZoom(t)))!==o){const o=(0,g.ZY)(this.cameraData.baseFovY/e),t=l.oR.near,i=l.oR.far;this.cameraModule.updateCameraProjection((new w.M).makePerspectiveFov(o,this.cameraData.aspect(),t,i))}return this.engine.broadcast(new y.Z(e)),e}checkTilingZoomLevels(e,o){if(e>=Z.X.highResThreshold&&this.zoomedSweep!==o){this.zoomedSweep=o;this.sweepTilingModule.enableZooming(!0,o.id)?this.uhQuality[o.id]=!0:(this.uhQuality[o.id]=!1,this.zoomedSweep=void 0)}else e<Z.X.highResThreshold&&this.zoomedSweep&&this.zoomedSweep===o&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep.id),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[null!=e?e:"none"]?Z.X.maxHighResZoom:Z.X.maxZoom}zoomBy(e){const o=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(o+e):o}validateViewmode(){return this.viewmodeData.isInside()&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*Z.X.zoomStep}pinchToZoomDelta(e){return e.pinchDelta*(Z.X.maxZoom-Z.X.minZoom)}zoomByInput(e){const o=this.cameraData.zoom();if(!this.validateViewmode())return o;const t=this.sweepData.currentSweep,i=(0,p.uZ)(o+e,Z.X.minZoom,this.getMaxZoom(t));return this.zoomTo(i)}keyHandler(e){if(e.state===r.M.DOWN)switch(e.key){case h.R.PLUSEQUALS:this.zoomByInput(Z.X.zoomStep);break;case h.R.DASHUNDERSCORE:this.zoomByInput(-Z.X.zoomStep);break;case h.R.OPENBRACKET:this.zoomTo(1)}}getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return Z.X.maxZoom;return this.sweepData.currentSweepObject.availableResolution(z.SL.ULTRAHIGH)>=z.SL.ULTRAHIGH?Z.X.maxHighResZoom:Z.X.maxZoom}}},69071:(e,o,t)=>{t.d(o,{X:()=>i});const i={zoomStep:.1,minZoom:.7,maxZoom:2,maxHighResZoom:3,highResThreshold:1.1}}}]);