(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[728],{49027:(t,e,i)=>{"use strict";i.d(e,{U:()=>s});class s{constructor(t){this.map=new Map,t.forEach((t=>this.map.set(t.state,t.subs)))}renew(t){(this.map.get(t)||[]).forEach((t=>t.renew()))}cancel(t){if(t){(this.map.get(t)||[]).forEach((t=>t.cancel()))}else this.map.forEach((t=>t.forEach((t=>t.cancel()))))}update(t,e){this.map.set(t,e)}}},36490:(t,e,i)=>{"use strict";i.d(e,{M:()=>l,n:()=>n});var s=i(81396),a=i(63926),o=i(25065),r=i(11748);const n={OpacityMaxDefault:1,OpacityMaxNonSelected:.4};class l extends s.Object3D{constructor(t){super(),this.text=t,this.maxOpacity=1,this.labelAnim=new a.z(0),this.filtered=!1,this.hidden=!1,this.selectState={active:!1,on:()=>{},off:()=>{}},this.validState={active:!0,on:()=>{const t=this.hoverState.active?r.BV.ColorHovered:r.BV.ColorDefault;this.text.setColor(t)},off:()=>{this.text.setColor(r.BV.ColorInvalid)}},this.hoverState={active:!1,on:()=>{this.validState.active&&this.text.setColor(r.BV.ColorHovered)},off:()=>{this.validState.active&&this.text.setColor(r.BV.ColorDefault)}},this.add(t)}use(t){this.data=t,this.userData.sid=t.sid,this.userData.data=t,this.text.use(this),this.labelUpdate(t.position,new s.Quaternion,"")}getId(){return this.data.sid}labelVisible(){return!this.filtered&&!this.hidden}updatePose(t,e){return this.labelUpdate(t,e,this.data.text),this}setMaxOpacity(t){this.maxOpacity=t,this.toggleLabel(this.labelVisible())}free(){this.labelAnim.value>0&&this.toggleLabel(!1)}tickAnimations(t){return this.animateLabelOpacity(.5*t),this}toggleLabel(t){this.hidden=!t,this.updateOpacity()}isHidden(){return this.hidden}toggleFiltered(t){t!==this.filtered&&(this.filtered=t,this.updateOpacity())}updateOpacity(){const t=this.labelVisible()?this.maxOpacity:0;this.labelAnim.endValue!==t&&this.labelAnim.modifyAnimation(this.labelAnim.value,t,o.R.FADE_DURATION)}animateLabelOpacity(t){const e=this.labelAnim.tick(t);Math.min(e,this.maxOpacity)!==this.text.opacity&&(this.text.opacity=e)}labelUpdate(t,e,i){this.text.position.copy(t),this.text.quaternion.copy(e),this.text.text=i}billboard(t,e,i,s,a,o,r){this.text.scaleBillboard(t,e,i,s,a,o,r)}}},11748:(t,e,i)=>{"use strict";i.d(e,{BV:()=>o,Es:()=>n,b6:()=>r});var s=i(71034),a=i(81396);const o={ColorDefault:16777215,ColorHovered:i(50831).I.MP_BRAND.getHex(),ColorInvalid:16750933};class r extends s.$7{use(t){this.userData.sid=t.data.sid,this.collider.data=t.data,this.collider.name=t.data.text,this.collider.labelMesh=t}}class n extends a.Mesh{constructor(){super(...arguments),this.hitTest=(()=>{const t=new a.Matrix4,e=new a.Ray,i=new a.Plane(new a.Vector3(0,0,-1)),s=new a.Vector3;return(a,o)=>{if(t.copy(this.matrixWorld).invert(),e.copy(a.ray).applyMatrix4(t),e.intersectPlane(i,s)){const t=this.scale.x/this.scale.y;let e=.5;t<1.5&&(e=1/t),Math.abs(s.x)<=e&&Math.abs(s.y)<=.75&&(s.applyMatrix4(this.matrixWorld),o.push({distance:a.ray.origin.distanceTo(s),point:s.clone(),object:this}))}}})()}labelVisible(){return!(!this.labelMesh||!this.labelMesh.labelVisible())}getId(){if(!this.data)throw new Error("LabelInputCollider used before configure");return this.data.sid}raycast(t,e){if(!this.labelVisible())return;if(this.material.depthTest)return void this.hitTest(t,e);const i=this.material.depthTest?e:[];this.hitTest(t,i),i.length>0&&(i[0].distance/=1e4,e.push(i[0]))}}},25065:(t,e,i)=>{"use strict";i.d(e,{R:()=>a,_:()=>s});const s=30,a={LABEL_SIZE:0,FADE_DURATION:200}},29460:(t,e,i)=>{"use strict";i.d(e,{B:()=>s,e:()=>n});var s,a=i(81396),o=i(91435),r=i(72803);!function(t){t[t.PIXELS=0]="PIXELS",t[t.METERS=1]="METERS"}(s||(s={}));class n extends a.Mesh{constructor(t,e,i){const n=new Float32Array([-9999,-9999,-9999,9999,9999,9999,-9999,-9999,-9999,9999,9999,9999,9999,9999,9999,-9999,-9999,-9999]),l=new Float32Array([1,1,0,0,-1,-1]),c=new Float32Array([0,1,0,1,0,1]),h=new a.InstancedBufferGeometry;h.setAttribute("position",new a.Float32BufferAttribute(n,3)),h.setAttribute("offsetDirection",new a.Float32BufferAttribute(l,1)),h.setAttribute("t",new a.Float32BufferAttribute(c,1)),h.setIndex([0,1,3,2,0,3,2,3,5,4,2,5]);const d={},u={};(null==e?void 0:e.dashUnits)===s.METERS&&(d.WORLDSPACE_DASH=!0,u.derivatives=!0);const p=null==e?void 0:e.fadeDistanceFromCamera;null!=p&&(d.FADE_DISTANCE_FROM_CAMERA=p.toFixed(2));super(h,new a.RawShaderMaterial({uniforms:a.UniformsUtils.clone(o.T.screenline.uniforms),side:a.DoubleSide,vertexShader:o.T.screenline.vertexShader,fragmentShader:o.T.screenline.fragmentShader,transparent:!0,depthTest:e.depthTest,depthWrite:e.depthWrite,depthFunc:e.depthFunc,defines:d,extensions:u})),this.cameraPose=i,this.updateEndpoints(t),this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.renderOrder=r.z.lines,this.onBeforeRender=t=>{t.getSize(this.material.uniforms.screenSize.value),null!=this.cameraPose&&this.material.uniforms.cameraPos.value.copy(this.cameraPose.position)},this.material.uniforms.dashed.value=+e.dashed,this.material.uniforms.dashSize.value=e.dashSize,this.material.uniforms.gapSize.value=e.gapSize,this.material.uniforms.lineWidth.value=e.lineWidth,this.material.uniforms.color.value.copy(e.color),this.material.uniforms.globalOpacity.value=e.globalOpacity}updateEndpoints(t){var e;3*t.length!==(null===(e=this.start)||void 0===e?void 0:e.length)&&(this.geometry.dispose(),this.start=new Float32Array(3*t.length),this.startAttrib=new a.InstancedBufferAttribute(this.start,3),this.geometry.setAttribute("start",this.startAttrib),this.end=new Float32Array(3*t.length),this.endAttrib=new a.InstancedBufferAttribute(this.end,3),this.geometry.setAttribute("end",this.endAttrib),this.opacity=new Float32Array(t.length),this.opacityAttrib=new a.InstancedBufferAttribute(this.opacity,1),this.geometry.setAttribute("opacity",this.opacityAttrib));for(let e=0;e<t.length;e++){const i=t[e].points,s=t[e].opacity;i[0].toArray(this.start,3*e),i[1].toArray(this.end,3*e),this.opacity[e]=null!=s?s:1}this.startAttrib.needsUpdate=!0,this.endAttrib.needsUpdate=!0,this.opacityAttrib.needsUpdate=!0}setVisibilityAt(t,e){const i=e?1:0;this.opacity[t]=i,this.opacityAttrib.needsUpdate=!0}globalOpacity(t){this.material.uniforms.globalOpacity.value=t}color(t){this.material.uniforms.color.value.copy(t)}lineWidth(t){this.material.uniforms.lineWidth.value=t}}},97140:(t,e,i)=>{"use strict";i.d(e,{$4:()=>o,oR:()=>a});var s=i(28438);const a=t=>!!t&&t instanceof s.g,o={hasMeshGroup:t=>"object"==typeof t&&!!t&&"meshGroup"in t,hasMeshSubgroup:t=>"object"==typeof t&&!!t&&"meshSubgroup"in t,isRoomMesh:a,isVisibleRoomMesh:t=>a(t)&&t.raycastEnabled&&t.visible}},52281:(t,e,i)=>{"use strict";i.d(e,{E:()=>s});const s={longerTransitionMaxDist:10,TRANSITION_TIME_DH:650,TRANSITION_TIME_ROOM:800}},58057:(t,e,i)=>{"use strict";i.d(e,{Gs:()=>l,Tq:()=>c,bG:()=>d});var s=i(61565),a=i(71835),o=i(52281);if(984==i.j)var r=i(59491);if(984==i.j)var n=i(38063);function l(t){return(0,r.k1)((()=>t(new n.ZK)),(()=>t(new n.Lp)),!1)}const c=(t,e,i,s,...a)=>h({sweepData:t,direction:e,directionFactor:i,sourceSweep:s,ignoreSweeps:a}),h=t=>{const{sweepData:e,direction:i,sourceSweep:o,ignoreSweeps:r,directionFactor:n}=t;if(!e.currentSweepObject)return[];const l=o||e.currentSweepObject,c=[s.ff(l),s._k(),s.vO(l),s.pI(l.position,i,n)];for(const t of r)c.push(s.ff(t));const h=[a.o7(l.position,i),a.TE(l.position)],d=e.getSweepNeighbours(l);return e.sortByScore(c,h,d)},d=(t,e,i,r)=>{const n=[s._k(),s._T()],l=[a.Dv(i.point)],c=t.currentSweepObject;e&&c&&n.push(s.ff(c),s.SF(c.position,o.E.longerTransitionMaxDist),s.vO(c)),i.face&&n.push(s.D5(i.point,i.face.normal));const h=r.floorIdFromObject(i.object);h&&l.push(a.Bv(h));const d=t.sortByScore(n,l);if(0===d.length){const e=t.getClosestSweep(i.point,!0);d.push({sweep:e,score:0})}return d}},83016:(t,e,i)=>{"use strict";i.d(e,{E:()=>v});var s=i(50831),a=i(66091),o=i(5829),r=i(97517),n=i(86743),l=i(81396),c=i(21998),h=i(60103),d=i(70873),u=i(59339);const p={baseState:{innerColor:s.I.WHITE,outerColor:s.I.WHITE,opacity:1},hoverState:{innerColor:s.I.WHITE,outerColor:s.I.NEPTUNE,opacity:1},selectState:{innerColor:s.I.WHITE,outerColor:s.I.NEPTUNE,opacity:1},dimState:{innerColor:s.I.WHITE,outerColor:s.I.WHITE,opacity:.5},highlightState:{innerColor:s.I.WHITE,outerColor:s.I.NEPTUNE,opacity:1}};class v extends h.H{constructor(t,e,i,h,v){const f=new Float32Array([0,0,0,1,0,0,1,0,1,0,0,1,-1,0,1,-1,0,0,1,0,2,-1,0,2,-1,0,-1,1,0,-1]),g=new l.BufferGeometry;g.setAttribute("position",new l.Float32BufferAttribute(f,3)),g.setIndex([0,1,2,0,2,3,0,3,4,0,4,5,3,2,6,3,7,4,0,9,1,0,5,8]);const m=new l.RawShaderMaterial({uniforms:l.UniformsUtils.clone(u.LD.uniforms),vertexShader:u.LD.vertexShader,fragmentShader:u.LD.fragmentShader,transparent:!0,depthTest:!1,stencilRef:65535,stencilFuncMask:1<<c.$.OPENINGS,stencilFail:l.KeepStencilOp,stencilZFail:l.KeepStencilOp,stencilZPass:l.KeepStencilOp,stencilFunc:l.GreaterStencilFunc,stencilWrite:!0,extensions:{derivatives:!0}});super(t,g,m,e),this.roomBoundViewData=i,this.lineLabel=h,this.isAddState=v,this.line3=new l.Line3(new l.Vector3,new l.Vector3),this.widthCache=.1,this.updateMaterial=()=>{super.updateMaterial(),this.targetColorScheme!==p.highlightState||this.isAddState()||(this.targetColorScheme=p.baseState);const t=this.material.uniforms;this.prevColorState.innerColor.copy(t.color.value),this.prevColorState.outerColor.copy(t.outlineColor.value),this.prevColorState.opacity=t.opacity.value;const e=this.selectState.active||this.highlightState.active,i=this.hoverState.active;this.renderOrder=e||i?c.o.HIGHLIGHTED_EDGE:c.o.EDGE,this.animation.modifyAnimation(0,1,d.rP,n.hl),this.lineLabel.setVisible(this.selectState.active||this.highlightState.active||this.hoverState.active)},this.raycast=(()=>{const t=new l.Vector3,e=new l.Vector2,i=new l.Vector2;return(s,a)=>{const o=this.line3.closestPointToPoint(s.ray.origin,!0,t);e.set(o.x,o.z),i.set(s.ray.origin.x,s.ray.origin.z);const n=e.distanceTo(i),c=s.ray.origin.distanceTo(this.line3.start),h=(0,r._U)(c,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),u=d.Nh*h;n<.5*Math.max(this.widthCache,d.ZT)+u&&a.push({distance:c,object:this,point:o.clone(),face:{a:-1,b:-1,c:-1,materialIndex:-1,normal:new l.Vector3(0,1,0)}})}})(),this.onEdgePositionChanged=(()=>{const t=new l.Vector3,e=new l.Vector3,i=new l.Vector3,s=new l.Vector3,o=new l.Vector3,r=new l.Vector3,n=new l.Vector3;return(l,c,h)=>{const d=l.getWall(this.roomBoundsId);d.from.getVec3(t),d.to.getVec3(e);const u=this.geometry.getAttribute("position");d.getBiasAdjustmentVec(n),i.set(t.x,t.y+c,t.z),s.set(e.x,e.y+c,e.z),o.addVectors(i,n),r.addVectors(s,n),this.line3.start.copy(o),this.line3.end.copy(r),this.material.uniforms.lineStart.value.copy(o),this.material.uniforms.lineEnd.value.copy(r),this.material.uniforms.width.value=d.width,this.stencilMat.uniforms.lineStart.value.copy(o),this.stencilMat.uniforms.lineEnd.value.copy(r),this.stencilMat.uniforms.width.value=d.width,this.widthCache=d.width,this.lineLabel.updateDimensions(o,r,d.width,h),u.setXYZ(0,i.x,i.y,i.z),u.setXYZ(3,s.x,s.y,s.z);const{fromLeft:p,fromRight:v,toLeft:f,toRight:g}=(0,a.b)(d,l);u.setXYZ(1,v.primary.x,v.primary.y+c,v.primary.z),u.setXYZ(2,g.primary.x,g.primary.y+c,g.primary.z),u.setXYZ(4,f.primary.x,f.primary.y+c,f.primary.z),u.setXYZ(5,p.primary.x,p.primary.y+c,p.primary.z),u.setXYZ(9,v.bevel.x,v.bevel.y+c,v.bevel.z),u.setXYZ(6,g.bevel.x,g.bevel.y+c,g.bevel.z),u.setXYZ(7,f.bevel.x,f.bevel.y+c,f.bevel.z),u.setXYZ(8,p.bevel.x,p.bevel.y+c,p.bevel.z),u.needsUpdate=!0,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere()}})(),this.renderOrder=c.o.EDGE,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.colors=p,this.material.uniforms.selectedWidth.value=.03;const y=m.clone();y.stencilRef=65535,y.stencilFuncMask=1<<c.$.OPENINGS,y.stencilWriteMask=1<<c.$.EDGE,y.stencilFail=l.KeepStencilOp,y.stencilZFail=l.KeepStencilOp,y.stencilZPass=l.ReplaceStencilOp,y.stencilFunc=l.AlwaysStencilFunc,y.stencilWrite=!0,y.colorWrite=!1,this.stencilMat=y;const b=new l.Mesh(this.geometry,this.stencilMat);b.renderOrder=c.o.EDGE_STENCIL,this.stencilMesh=b;const x=s.I.WHITE.clone();this.animation.onChanged((()=>{const t=this.prevColorState,e=this.targetColorScheme;this.material.uniforms.outlineColor.value.lerpColors(t.outerColor,e.outerColor,this.animation.value);this.material.uniforms.color.value.lerpColors(t.innerColor,e.innerColor,this.animation.value);const i=(0,o.t)(t.opacity,e.opacity,this.animation.value);this.opacity=i,x.copy(s.I.WHITE).multiplyScalar(this.opacity)})),this.onBeforeRender=()=>{this.material.depthTest=1===this.pitchFactor,this.material.uniforms.opacity.value=(1-this.pitchFactor)*this.opacity*Number(this.roomBoundViewData.roomWallsVisible),this.lineLabel.update()},this.matrixAutoUpdate=!1,this.matrixWorldAutoUpdate=!1}tickAnimations(t){super.tickAnimations(t),this.lineLabel.tickAnimations(t)}setLabelVisible(t){this.lineLabel.setVisible(t)}dispose(){super.dispose(),this.lineLabel.dispose()}}},72154:(t,e,i)=>{"use strict";i.d(e,{G:()=>v});var s=i(81396),a=i(21998),o=i(60103),r=i(50831),n=i(59339),l=i(5829),c=i(86743),h=i(70873),d=i(97517);const u={baseState:{opacity:1,innerColor:r.I.MIRROR,outerColor:r.I.PORTAL},hoverState:{opacity:1,innerColor:r.I.MIRROR,outerColor:r.I.PORTAL},selectState:{opacity:1,innerColor:r.I.MP_BRAND,outerColor:r.I.WHITE},dimState:{opacity:1,innerColor:r.I.MIRROR,outerColor:r.I.PORTAL}};class p extends s.RawShaderMaterial{constructor(){super({fragmentShader:n.pr.fragmentShader,vertexShader:n.pr.vertexShader,uniforms:s.UniformsUtils.clone(n.pr.uniforms),name:"HandleMaterial",transparent:!0,depthTest:!1,extensions:{derivatives:!0}})}}class v extends o.H{constructor(t,e,i){const o=new Float32Array([-1,0,-1,1,0,-1,1,0,1,-1,0,1]),r=new s.BufferGeometry;r.setAttribute("position",new s.Float32BufferAttribute(o,3)),r.setIndex([0,2,1,0,3,2]),super(t,r,new p,e),this.roomBoundViewData=i,this.targetRadius=.3,this.prevRadius=.3,this.renderOrder=a.o.NODE,this.colors=u,this.animation.onChanged((()=>this.onAnimationChange())),this.onBeforeRender=()=>{this.material.uniforms.opacity.value=this.opacity*(1-this.pitchFactor)*Number(this.roomBoundViewData.roomWallsVisible)}}onAnimationChange(){const t=this.prevColorState,e=this.targetColorScheme;this.material.uniforms.outlineColor.value.lerpColors(t.outerColor,e.outerColor,this.animation.value),this.material.uniforms.baseColor.value.lerpColors(t.innerColor,e.innerColor,this.animation.value),this.opacity=(0,l.t)(t.opacity,e.opacity,this.animation.value);const i=(0,l.t)(this.prevRadius,this.targetRadius,this.animation.value);this.setRadius(i)}onRender(t,e){super.onRender(t,e),this.visible=this.pitchFactor<1}raycast(t,e){const i=[];if(super.raycast(t,i),i.length>0){const s=i[0].point,a=t.ray.origin.distanceTo(this.position),o=(0,d._U)(a,this.cameraData.pose.projection.asThreeMatrix4(),this.cameraData.width),r=h.Nh*o;s.distanceTo(this.position)<h.pp+r&&e.push(i[0])}}updateMaterial(){this.prevRadius=this.material.uniforms.radius.value,this.targetRadius=h.pp+(this.hoverState.active?h.XG:0)+(this.selectState.active?h.XG:0),super.updateMaterial(),this.prevColorState.innerColor.copy(this.material.uniforms.baseColor.value),this.prevColorState.outerColor.copy(this.material.uniforms.outlineColor.value),this.prevColorState.opacity=this.material.opacity,this.animation.modifyAnimation(0,1,h.rP,c.hl)}setRadius(t){this.material.uniforms.radius.value=t}updatePosition(t){this.position.copy(t)}}},93002:(t,e,i)=>{"use strict";i.d(e,{EK:()=>y,ch:()=>f,jr:()=>b,pG:()=>m});var s=i(50831),a=i(86743),o=i(81396),r=i(72154),n=i(21998),l=i(60103),c=i(59339),h=i(17516),d=i(70873);class u extends o.RawShaderMaterial{constructor(){super({fragmentShader:c.z6.fragmentShader,vertexShader:c.z6.vertexShader,uniforms:o.UniformsUtils.clone(c.z6.uniforms),name:"OpeningMaterial",depthTest:!1,transparent:!0,stencilFunc:o.AlwaysStencilFunc,stencilWrite:!1})}}const p=new o.BoxGeometry(1,1,1);class v extends l.H{constructor(t,e,i,a){super(t,p.clone(),new u,i),this.floorId=e,this.roomBoundViewData=a,this.onEdgePositionChanged=(()=>{const t=new o.Vector3;return(e,i,s,a)=>{t.subVectors(i,e),this.scale.set(t.length(),.05,s),this.stencilPrepass&&this.stencilPrepass.scale.set(t.length(),.05,s);const o=Math.atan2(i.x-e.x,i.z-e.z)+Math.PI/2;this.rotation.y=o,this.stencilPrepass&&(this.stencilPrepass.rotation.y=o);const r=t.addVectors(i,e).multiplyScalar(.5);this.position.copy(r),this.stencilPrepass&&this.stencilPrepass.position.copy(r),this.startHandle.position.copy(e),this.endHandle.position.copy(i);const n=a===h.u.DOOR?1:0;this.material.uniforms.isDoor.value=n,this.stencilPrepass&&(this.stencilPrepass.material.uniforms.isDoor.value=n)}})(),this.renderOrder=n.o.OPENING_LINES,this.startHandle=new y(t,i,a,this),this.endHandle=new b(t,i,a,this),this.animation.onChanged((()=>{this.material.uniforms.baseColor.value.lerpColors(s.I.WHITE,s.I.NEPTUNE,this.animation.value)}))}onRender(t,e){super.onRender(t,e),this.visible=this.pitchFactor<1&&this.roomBoundViewData.roomWallsVisible,this.startHandle.onRender(t,e),this.endHandle.onRender(t,e),this.stencilPrepass&&this.stencilPrepass.onRender(t,e)}updateMaterial(){const t=this.selectState.active||this.hoverState.active||this.highlightState.active;this.animation.modifyAnimation(this.animation.value,t?1:0,d.rP,a.hl)}tickAnimations(t){super.tickAnimations(t),this.startHandle.tickAnimations(t),this.endHandle.tickAnimations(t)}}class f extends v{constructor(t,e,i,s){super(t,e,i,s),this.floorId=e,this.stencilPrepass=new g(t,e,i,s)}}class g extends v{constructor(t,e,i,s){super(t,e,i,s),this.floorId=e,this.renderOrder=n.o.OPENING_STENCIL,this.material.colorWrite=!1,this.material.stencilRef=65535,this.material.stencilFuncMask=1<<n.$.OPENINGS,this.material.stencilWriteMask=1<<n.$.OPENINGS,this.material.stencilFail=o.ReplaceStencilOp,this.material.stencilZFail=o.ReplaceStencilOp,this.material.stencilZPass=o.ReplaceStencilOp,this.material.stencilFunc=o.AlwaysStencilFunc,this.material.stencilWrite=!0}raycast(t,e){}}class m extends r.G{constructor(t,e,i,s){super(t,e,i),this.parentOpeningView=s}}class y extends m{}class b extends m{}},21998:(t,e,i)=>{"use strict";i.d(e,{$:()=>a,o:()=>s});var s,a,o=i(72803);!function(t){t[t.BASE=o.z.roomBounds]="BASE",t[t.OPENING_STENCIL=o.z.roomBounds+1]="OPENING_STENCIL",t[t.EDGE_STENCIL=o.z.roomBounds+2]="EDGE_STENCIL",t[t.ROOM=o.z.roomBounds+3]="ROOM",t[t.EDGE=o.z.roomBounds+4]="EDGE",t[t.HIGHLIGHTED_EDGE=o.z.roomBounds+5]="HIGHLIGHTED_EDGE",t[t.OPENING_LINES=o.z.roomBounds+6]="OPENING_LINES",t[t.NODE=o.z.roomBounds+7]="NODE"}(s||(s={})),function(t){t[t.OPENINGS=0]="OPENINGS",t[t.EDGE=1]="EDGE"}(a||(a={}))},60103:(t,e,i)=>{"use strict";i.d(e,{H:()=>n});var s=i(11250),a=i(63926),o=i(81396),r=i(21998);class n extends o.Mesh{constructor(t,e,i,s){super(e,i),this.roomBoundsId=t,this.cameraData=s,this.animation=new a.z(0),this.prevColorState={opacity:1,innerColor:new o.Color,outerColor:new o.Color},this.pitchFactor=1,this.raycastEnabled=!0,this.opacity=1,this.selectState={active:!1,on:()=>{this.updateMaterial()},off:()=>{this.updateMaterial()}},this.hoverState={active:!1,on:()=>{this.updateMaterial()},off:()=>this.updateMaterial()},this.highlightState={active:!1,on:()=>this.updateMaterial(),off:()=>this.updateMaterial()},this.dimState={active:!1,on:()=>this.updateMaterial(),off:()=>this.updateMaterial()},this.name=t,this.renderOrder=r.o.BASE}updateMaterial(){var t;let e=this.colors.baseState;this.dimState.active&&(e=this.colors.dimState),this.hoverState.active&&(e=this.colors.hoverState),this.highlightState.active&&(e=null!==(t=this.colors.highlightState)&&void 0!==t?t:this.colors.selectState),this.selectState.active&&(e=this.colors.selectState);e!==this.targetColorScheme&&(this.targetColorScheme=e)}tickAnimations(t){this.animation.tick(t)}dispose(){}raycast(t,e){if(!this.raycastEnabled)return;const i=[];super.raycast(t,i),i.length>0&&e.push(i[0])}onRender(t,e){this.pitchFactor=t,this.raycastEnabled=(0,s.Eb)(this.pitchFactor)}}},70873:(t,e,i)=>{"use strict";i.d(e,{Nh:()=>a,XG:()=>r,ZT:()=>o,bk:()=>l,jE:()=>d,mU:()=>h,pp:()=>s,qb:()=>c,rP:()=>n,w1:()=>u});const s=.06,a=7,o=.1,r=.02,n=100,l=8,c=500,h=.9,d=1e3,u="room-label-collision"},59339:(t,e,i)=>{"use strict";i.d(e,{AK:()=>D,LD:()=>T,Ud:()=>O,pr:()=>w,z6:()=>P});var s=i(50831),a=i(81396),o=i(67498),r=i.n(o),n=i(73293),l=i.n(n),c=i(40134),h=i.n(c),d=i(93670),u=i.n(d),p=i(86242),v=i.n(p),f=i(14536),g=i.n(f),m=i(47706),y=i.n(m),b=i(72292),x=i.n(b),S=i(25888),E=i.n(S),C=i(73868),M=i.n(C),A=i(70873);const w={uniforms:{outlineColor:{type:"v4",value:s.I.BLACK},baseColor:{type:"v4",value:s.I.SINE},outlinePct:{type:"f",value:.8},radius:{type:"f",value:A.pp},opacity:{type:"f",value:1}},vertexShader:r(),fragmentShader:l()},T={uniforms:{outlineColor:{type:"v3",value:s.I.WHITE},color:{type:"v3",value:s.I.WHITE},lineStart:{type:"v3",value:new a.Vector3},lineEnd:{type:"v3",value:new a.Vector3},width:{type:"f",value:1},selectedWidth:{type:"f",value:.01},opacity:{type:"f",value:1}},vertexShader:h(),fragmentShader:u()},P={uniforms:{baseColor:{type:"v4",value:s.I.WHITE},isDoor:{type:"f",value:1},opacity:{type:"f",value:1}},vertexShader:v(),fragmentShader:g()},D={uniforms:{opacity:{type:"f",value:1},centerSpacing:{type:"f",value:24},radius:{type:"f",value:4},color:{type:"v4",value:s.I.LENS_GRAY}},vertexShader:y(),fragmentShader:x()},O={uniforms:{tip:{type:"v2",value:new a.Vector2},normal:{type:"v2",value:new a.Vector2},height:{type:"f",value:0},color:{type:"v4",value:s.I.WHITE},opacity:{type:"f",value:1},outline:{type:"f",value:1},outlineColor:{type:"v4",value:s.I.BLACK},screenSize:{type:"v2",value:new a.Vector2},tipPaddingPx:{type:"f",value:2},widthPx:{type:"f",value:12},heightPx:{type:"f",value:6},aaPaddingPx:{type:"f",value:2},metersPerPx:{type:"f",value:.01},autoScale:{type:"f",value:1}},vertexShader:E(),fragmentShader:M()}},47096:(t,e,i)=>{"use strict";i.d(e,{Y:()=>l});var s=i(67540),a=i(24826),o=i(71759),r=i(84294),n=i(2342);class l{constructor(t,e){this.editor=t,this.data=e,this.readBindings=[],this.mover={onMove:(t,e)=>{}},this.onCurrentChange=({target:t})=>{this.editor.state.toolState!==o.M.ToolState.ADDING&&this.clearHighlightedViews(),this.highlightView(t)},this.onSelectChange=({target:t})=>{this.setSelectedView(t)},this.onHoverChange=({target:t,previous:e})=>{if(this.editor.state.toolState===o.M.ToolState.ADDING)return;if(!t)return this.editor.clearAllDims(),this.editor.clearAllHighlights(),void(this.editor.state.selected&&this.setSelectedView(this.editor.state.selected));const i=this.data.getEntity(t);this.hoverView(i)},this.editableEntities=new r.C.EditorEntityAdapter(this.editor)}addEditableEntity(t,e){this.editableEntities.registerEntity(e,this,t)}removeEditableEntity(t){this.editableEntities.unregisterEntity(t)}activate(){0===this.readBindings.length?this.readBindings.push(this.editor.subscribe(n.q.Events.CurrentChange,this.onCurrentChange),this.editor.subscribe(n.q.Events.SelectChange,this.onSelectChange),this.editor.subscribe(o.M.Events.HoverChange,this.onHoverChange)):this.readBindings.forEach((t=>t.renew()))}deactivate(){this.readBindings.forEach((t=>t.cancel()))}clearHighlightedViews(){this.editor.clearAllHighlights()}highlightView(t){if(!t)return;const e=this.data.getEntity(t);e instanceof a.c&&this.editor.highlight(t,e.from.id,e.to.id)}setSelectedView(t){if(!t)return void this.editor.clearAllDims();const e=this.data.getEntity(t);e instanceof a.c&&this.editor.highlight(e.from.id,e.to.id),e instanceof s.JJ&&(this.clearHighlightedViews(),this.dimAllRooms(),this.selectRoom(e))}dimAllRooms(){this.editor.clearAllDims();for(const[,t]of this.data.rooms)this.dimRoom(t)}hoverView(t){t instanceof s.JJ&&this.hoverRoom(t)}hoverRoom(t){const e=t.id;this.editor.clearDim(e);for(const e of t.walls)this.editor.clearDim(e.id);for(const e of t.points)this.editor.clearDim(e.id)}selectRoom(t){const e=t.id;this.editor.clearDim(e);for(const e of t.walls)this.editor.clearDim(e.id);for(const e of t.points)this.editor.clearDim(e.id)}dimRoom(t){const e=t.id;this.editor.dim(e);for(const e of t.walls)this.editor.dim(e.id);for(const e of t.points)this.editor.dim(e.id)}}},38082:(t,e,i)=>{"use strict";i.d(e,{v:()=>s});const s=[{outerRadius:1,innerRadius:.97,color:0,opacity:.1},{outerRadius:.97,innerRadius:.65,color:16777215,opacity:.64},{outerRadius:.65,innerRadius:.62,color:0,opacity:.13}]},84294:(t,e,i)=>{"use strict";i.d(e,{C:()=>a});var s,a,o=i(71759),r=i(2342);!function(t){class e extends o.M.DragAndDropBase{constructor(t=new i){super(t,new o.M.EventConstructors(s.AddStart,s.EditStart,s.AddConfirm,s.AddDiscard,s.EditConfirm,s.EditDiscard,s.Delete,s.Move,s.CurrentChange,s.SelectChange,s.ValidChange)),this.state=t}add(t){this.internalAdd(new Set(t))}edit(t){this.internalEdit(new Set(t))}place(t){this.internalPlace(new Set(t))}select(t,e){const i=(null==e?void 0:e.addToExistingSelection)&&this.state.selected?Array.from(this.state.selected.keys()).concat(t):t;this.internalSelect(new Set(i),e)}toggleSelect(t){var e;const i=new Set(null===(e=this.state.selected)||void 0===e?void 0:e.keys());for(const e of t)i.has(e)?i.delete(e):i.add(e);this.internalSelect(i)}}t.DragAndDrop=e;class i extends o.M.BaseState{}let s;t.State=i,function(t){class e extends o.M.Events.BaseAddStart{}t.AddStart=e;class i extends o.M.Events.BaseEditStart{}t.EditStart=i;class s extends o.M.Events.BaseAddConfirm{}t.AddConfirm=s;class a extends o.M.Events.BaseAddDiscard{}t.AddDiscard=a;class r extends o.M.Events.BaseEditConfirm{}t.EditConfirm=r;class n extends o.M.Events.BaseEditDiscard{}t.EditDiscard=n;class l extends o.M.Events.BaseDelete{}t.Delete=l;class c extends o.M.Events.BaseMove{}t.Move=c;class h extends o.M.Events.BaseCurrentChange{}t.CurrentChange=h;class d extends o.M.Events.BaseSelectChange{}t.SelectChange=d;class u extends o.M.Events.BaseValidChange{}t.ValidChange=u}(s=t.Events||(t.Events={}))}(s||(s={})),function(t){const e={[o.M.Events.HoverChange.type]:"hoverState",[o.M.Events.HighlightAdd.type]:"highlightState",[o.M.Events.HighlightClear.type]:"highlightState",[o.M.Events.DimAdd.type]:"dimState",[o.M.Events.DimClear.type]:"dimState"};class i{constructor(t){this.editor=t,this.bindings=[],this.entities=new Map,this.bindings.push(this.editor.subscribe(o.M.Events.HoverChange,(t=>this.bindTargetedCallback(o.M.Events.HoverChange.type,t))),this.editor.subscribe(o.M.Events.HighlightAdd,(t=>this.bindTargetedCallback(o.M.Events.HighlightAdd.type,t))),this.editor.subscribe(o.M.Events.HighlightClear,(t=>this.bindClearCallback(o.M.Events.HighlightClear.type,t))),this.editor.subscribe(o.M.Events.DimAdd,(t=>this.bindTargetedCallback(o.M.Events.DimAdd.type,t))),this.editor.subscribe(o.M.Events.DimClear,(t=>this.bindClearCallback(o.M.Events.DimClear.type,t))))}registerEntity(t,...e){let i=this.entities.get(t);i||(i=[]),i.push(...e),this.entities.set(t,i)}unregisterEntity(t){return this.entities.delete(t)}bindTargetedCallback(t,e){const{target:i,previousTarget:s}=this.getTargetAndPrevIds(e),a=this.eventToCallbackMapping[t];if(!a)throw Error(`implement targetted callback for ${t}`);for(const t of s)(this.entities.get(t)||[]).forEach((t=>{a in t&&(t[a].active=!1,t[a].off())}));for(const t of i)(this.entities.get(t)||[]).forEach((t=>{a in t&&(t[a].active=!0,t[a].on())}))}bindMoveCallback(t){const{target:e}=this.getTargetAndPrevIds(t);for(const i of e)(this.entities.get(i)||[]).forEach((e=>{e.mover&&t.target&&e.mover.onMove(i,t.ev)}))}bindClearCallback(t,e){const i=this.eventToCallbackMapping[t],{target:s}=this.getTargetAndPrevIds(e);for(const t of s)(this.entities.get(t)||[]).forEach((t=>{i in t&&(t[i].active=!1,t[i].off())}))}}t.BaseEditorEntityAdapter=i;t.EditorEntityAdapter=class extends i{constructor(t){super(t),this.eventToCallbackMapping=Object.assign(Object.assign({},e),{[r.q.Events.SelectChange.type]:"selectState",[r.q.Events.ValidChange.type]:"validState",[r.q.Events.Move.type]:"mover"}),this.bindings.push(this.editor.subscribe(r.q.Events.SelectChange,(t=>this.bindTargetedCallback(r.q.Events.SelectChange.type,t))),this.editor.subscribe(r.q.Events.ValidChange,(t=>this.bindTargetedCallback(r.q.Events.ValidChange.type,t))),this.editor.subscribe(r.q.Events.Move,(t=>this.bindMoveCallback(t))))}getTargetAndPrevIds(t){if(o.M.Events.hasTargetAndPrev(t))return{target:t.target?[t.target]:[],previousTarget:t.previous?[t.previous]:[]};if(o.M.Events.hasTarget(t))return{target:t.target?[t.target]:[],previousTarget:[]};throw new Error("Unexpected message!!")}};t.MultiSelectEditorEntityAdapter=class extends i{constructor(t){super(t),this.eventToCallbackMapping=Object.assign(Object.assign({},e),{[s.Events.SelectChange.type]:"selectState",[s.Events.ValidChange.type]:"validState",[s.Events.Move.type]:"mover"}),this.bindings.push(this.editor.subscribe(s.Events.SelectChange,(t=>this.bindTargetedCallback(s.Events.SelectChange.type,t))),this.editor.subscribe(s.Events.ValidChange,(t=>this.bindTargetedCallback(s.Events.ValidChange.type,t))),this.editor.subscribe(s.Events.Move,(t=>this.bindMoveCallback(t))))}getTargetAndPrevIds(t){const e=t=>t instanceof Set?Array.from(t.keys()):null!==t?[t]:[];if(o.M.Events.hasTargetAndPrev(t))return{target:t.target?e(t.target):[],previousTarget:t.previous?e(t.previous):[]};if(o.M.Events.hasTarget(t))return{target:t.target?e(t.target):[],previousTarget:[]};throw new Error("Unexpected message!!")}}}(a||(a={}))},2342:(t,e,i)=>{"use strict";i.d(e,{q:()=>s});var s,a=i(71759);!function(t){class e extends a.M.DragAndDropBase{constructor(t=new i){super(t,new a.M.EventConstructors(s.AddStart,s.EditStart,s.AddConfirm,s.AddDiscard,s.EditConfirm,s.EditDiscard,s.Delete,s.Move,s.CurrentChange,s.SelectChange,s.ValidChange)),this.state=t}add(t){this.internalAdd(t)}edit(t){this.internalEdit(t)}place(t){this.internalPlace(t)}select(t,e){this.internalSelect(t,e)}toggleSelect(t){this.state.selected===t?this.deselect():this.select(t)}}t.DragAndDrop=e;class i extends a.M.BaseState{}let s;t.State=i,function(t){class e extends a.M.Events.BaseAddStart{}t.AddStart=e;class i extends a.M.Events.BaseEditStart{}t.EditStart=i;class s extends a.M.Events.BaseAddConfirm{}t.AddConfirm=s;class o extends a.M.Events.BaseAddDiscard{}t.AddDiscard=o;class r extends a.M.Events.BaseEditConfirm{}t.EditConfirm=r;class n extends a.M.Events.BaseEditDiscard{}t.EditDiscard=n;class l extends a.M.Events.BaseDelete{}t.Delete=l;class c extends a.M.Events.BaseMove{}t.Move=c;class h extends a.M.Events.BaseCurrentChange{}t.CurrentChange=h;class d extends a.M.Events.BaseSelectChange{}t.SelectChange=d;class u extends a.M.Events.BaseValidChange{}t.ValidChange=u}(s=t.Events||(t.Events={}))}(s||(s={}))},71034:(t,e,i)=>{"use strict";i.d(e,{$7:()=>h,uc:()=>u,N3:()=>c});var s=i(81396),a=i(4679),o=i(11250),r=i(43627),n=i(96783),l=i(97517);var c;(0,a.Dy)({unicodeFontsURL:"https://static.matterport.com/webgl-vendors/unicode-font-resolver/1.0.1/"}),function(t){t.WORLD="world",t.NDC="ndc"}(c||(c={}));class h extends s.Object3D{constructor(t,e=c.WORLD){var i,o,r,n;super(),this.config=t,this.scaleType=e,this.unscaledWidth=0,this.unscaledHeight=0,this.labelTextMaterial=new s.MeshBasicMaterial,this.bindings=[];const l=this.config.background||this.config.backgroundAsCollider;if(l){this.config.backgroundOpacity=void 0!==this.config.backgroundOpacity?this.config.backgroundOpacity:1,this.config.backgroundOpacity=this.config.background?this.config.backgroundOpacity:0;const e=this.createQuadGeometry(),i=new s.MeshBasicMaterial({color:t.backgroundColor,transparent:!0,depthTest:this.config.backgroundOpacity>0&&!t.disableDepth,depthWrite:this.config.backgroundOpacity>0&&!t.disableDepth,opacity:this.config.backgroundOpacity,stencilRef:1,stencilFail:s.KeepStencilOp,stencilZFail:s.KeepStencilOp,stencilZPass:s.ReplaceStencilOp,stencilFunc:s.AlwaysStencilFunc,stencilWrite:!0});this.labelBackgroundMesh=new this.config.backgroundColliderType(e,i),this.labelBackgroundMesh.position.z=-.01,this.labelBackgroundMesh.name="Label Background",this.collider=this.labelBackgroundMesh,this.add(this.labelBackgroundMesh)}const h=this.labelTextMesh=new a.xv;h.material=this.labelTextMaterial,h.name="Label Text",h.text=t.text||"",h.renderOrder=10,h.font=`${null!==(i=t.assetBasePath)&&void 0!==i?i:""}${t.fontPath}`,h.lang=t.lang,h.fontSize=1,h.fontWeight=700,h.anchorX="50%",h.anchorY="50%",h.outlineWidth=t.outline?t.outlineWidth:0,h.maxWidth=t.wordWrapWidth,h.textAlign=t.align,h.depthOffset=t.depthOffset||0,l&&(h.raycast=()=>{}),h.addEventListener("synccomplete",(()=>{var t;const[e,i,s,a]=h.textRenderInfo.visibleBounds;let o=s-e,r=a-i;isFinite(o)&&isFinite(r)&&(l&&(o+=this.config.backgroundBorderWidth,r+=this.config.backgroundBorderHeight,this.labelBackgroundMesh.scale.set(o,r,1)),this.unscaledWidth=o,this.unscaledHeight=r,this.aspect=o/Math.max(r,.001),h.position.set("50%"===h.anchorX?(e+s)/-2:0,"50%"===h.anchorY?(i+a)/-2:0,0),null===(t=this._onGeomUpdate)||void 0===t||t.call(this))})),this.scaleFactor=null!==(o=t.scale)&&void 0!==o?o:1,this.opacity=null!==(r=t.opacity)&&void 0!==r?r:1,this.setColor(null!==(n=t.color)&&void 0!==n?n:0),this.add(h),h.sync(),this.name="Label Container"}dispose(){this.bindings.forEach((t=>t.cancel())),this.labelTextMesh.dispose()}onGeomUpdate(t){this._onGeomUpdate=t}get text(){return this.config.text}set text(t){this.config.text=t,this.labelTextMesh.text=t,this.labelTextMesh.sync()}get mesh(){return this.labelTextMesh}getUnscaledSize(){return{width:this.unscaledWidth,height:this.unscaledHeight}}get scaleFactor(){return this.config.scale}set scaleFactor(t){this.config.scale=t,this.scale.setScalar(t)}get opacity(){return void 0!==this.config.opacity?this.config.opacity:1}set opacity(t){if(t!==this.config.opacity){this.config.opacity=t;const e=t>0&&!this.config.disableDepth;if(this.config.background){const i=this.labelBackgroundMesh.material;i.opacity=Math.min(this.config.backgroundOpacity||1,t),i.depthWrite=t>.15,i.depthTest=e}const i=this.labelTextMaterial;i.opacity=t,i.depthTest=e,this.visible=t>0,this.labelBackgroundMesh.visible=this.visible}}setColor(t){this.labelTextMaterial.color.set(t)}setRenderLayer(t){this.labelTextMesh.layers.mask=t.mask,this.labelBackgroundMesh&&(this.labelBackgroundMesh.layers.mask=t.mask)}setRenderOrder(t){this.renderOrder=t,this.labelTextMesh.renderOrder=t,this.labelBackgroundMesh&&(this.labelBackgroundMesh.renderOrder=t)}setPosition(t,e=(t=>t)){this.position.copy(e(t))}setOrientation(t,e=0){this.quaternion.copy(t),0!==e&&this.rotateZ(-e*r.Ue)}scaleBillboard(t,e,i,s,a,r,h=d.SCALE_DEFAULT){if(0!==i.elements[15])this.scaleFactor=.2*h*s*(d.ORTHO_IDEAL_HEIGHT/a);else{const u=(0,o.D_)(this.position,t,e,i.asThreeMatrix4()),p=Math.abs(u.x);if(p<1){const e=(0,l.mY)(i,t,this.position,a,h),o=((0,n.uZ)(r,1,2.5)+s)*d.SCALE_ASPECT,u=1+d.SCALE_NDC-p*d.SCALE_NDC-o,v=Math.max(Math.min(1/e*u,3),.001);this.scaleType===c.NDC?this.scaleFactor=v:this.scaleFactor=Math.min(v*d.NDC_MULT,h*d.SCALE_WORLD)}else this.scaleFactor=.001}}createQuadGeometry(){const t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),e=new Float32Array([0,0,-1,0,0,-1,0,0,-1,0,0,-1]),i=new s.BufferGeometry;return i.setAttribute("position",new s.BufferAttribute(t,3)),i.setIndex([0,1,2,0,2,3]),i.setAttribute("normal",new s.BufferAttribute(e,3)),i}}const d={SCALE_DEFAULT:.1,SCALE_WORLD:4,SCALE_NDC:.5,SCALE_ASPECT:.035,DEPTH_WRITE_THRESHOD:.15,ORTHO_IDEAL_HEIGHT:1500,NDC_MULT:1.15};class u{constructor(t){this.currentTextConfig=u.defaultTextConfig,t?this.updateTextStyle(t):this.updateTextStyle(u.defaultTextConfig)}updateTextStyle(t){this.currentTextConfig=Object.assign(Object.assign({},this.currentTextConfig),t)}createLabel(t={text:""}){return new h(Object.assign(Object.assign({},this.currentTextConfig),t))}async preload(t={text:""}){const e=Object.assign(Object.assign({},this.currentTextConfig),t);return new Promise((t=>{var i;(0,a.C5)({font:`${null!==(i=e.assetBasePath)&&void 0!==i?i:""}${e.fontPath}`,characters:e.text},t)}))}static makeConfig(t){return Object.assign(Object.assign({},u.defaultTextConfig),t)}}u.defaultTextConfig={text:"",fontPath:"fonts/roboto-700.woff",align:"center",wordWrapWidth:void 0,color:"black",backgroundColor:"white",backgroundBorderWidth:.9,backgroundBorderHeight:.7,background:!0,backgroundAsCollider:!0,backgroundColliderType:s.Mesh,scale:1,outline:!1,outlineWidth:.06}},73868:t=>{t.exports="precision highp float;uniform float aaPaddingPx;uniform vec3 color;uniform float opacity;varying vec2 vOffsetPx;uniform float outline;uniform vec3 outlineColor;varying vec2 scaledWidthHeightPx;float sdTriangle(vec2 p,vec2 p0,vec2 p1,vec2 p2){vec2 e0=p1-p0;vec2 e1=p2-p1;vec2 e2=p0-p2;vec2 v0=p-p0;vec2 v1=p-p1;vec2 v2=p-p2;vec2 pq0=v0-e0*clamp(dot(v0,e0)/dot(e0,e0),0.,1.);vec2 pq1=v1-e1*clamp(dot(v1,e1)/dot(e1,e1),0.,1.);vec2 pq2=v2-e2*clamp(dot(v2,e2)/dot(e2,e2),0.,1.);float s=e0.x*e2.y-e0.y*e2.x;vec2 d=min(min(vec2(dot(pq0,pq0),s*(v0.x*e0.y-v0.y*e0.x)),vec2(dot(pq1,pq1),s*(v1.x*e1.y-v1.y*e1.x))),vec2(dot(pq2,pq2),s*(v2.x*e2.y-v2.y*e2.x)));return-sqrt(d.x)*sign(d.y);}void main(){float padding=aaPaddingPx+outline;float halfWidth=scaledWidthHeightPx.x/2.;vec2 p0=vec2(-halfWidth,scaledWidthHeightPx.y+padding);vec2 p1=vec2(halfWidth,scaledWidthHeightPx.y+padding);vec2 p2=vec2(0.,padding);float sd=sdTriangle(vOffsetPx,p0,p1,p2);float aaOpacity=1.-smoothstep(outline,outline+0.5,sd);float colorMix=smoothstep(0.,outline,sd);vec3 colorWithOutline=mix(color,outlineColor,colorMix);gl_FragColor=vec4(colorWithOutline,aaOpacity*opacity);}"},25888:t=>{t.exports="precision highp float;uniform vec2 screenSize;vec2 rotate90(vec2 v){return vec2(-v.y,v.x);}vec2 ndcToScreen(vec4 pt){return(vec2(pt.x,pt.y)+vec2(1.,1.))*screenSize/2.;}vec2 screenToNdc(vec2 pt){return(pt*2./screenSize)-vec2(1.,1.);}\n#define MIN_SCALE  0.4\n#define MIN_METERS_PER_PX  0.006\n#define MAX_METERS_PER_PX  0.012\nuniform float tipPaddingPx;uniform float widthPx;uniform float heightPx;uniform float aaPaddingPx;uniform float metersPerPx;uniform float outline;uniform vec2 tip;uniform vec2 normal;uniform float height;uniform float autoScale;attribute vec2 offset;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;varying vec2 vOffsetPx;varying vec2 scaledWidthHeightPx;vec2 scaleByZoom(){float t=clamp((metersPerPx-MIN_METERS_PER_PX)/(MAX_METERS_PER_PX-MIN_METERS_PER_PX),0.,1.);float scale=1.;if(autoScale>0.){scale=mix(1.,MIN_SCALE,t);}return vec2(widthPx,heightPx)*scale;}void main(){vec2 yAxis=normal;vec2 xAxis=rotate90(yAxis);vec4 tipWorld=vec4(tip.x,height,tip.y,1.);vec4 xOffsetWorld=tipWorld+vec4(xAxis.x,0.,xAxis.y,0.);vec4 yOffsetWorld=tipWorld+vec4(yAxis.x,0.,yAxis.y,0.);vec4 ndcTip=projectionMatrix*modelViewMatrix*tipWorld;vec2 tipScreen=ndcToScreen(ndcTip/ndcTip.w);vec4 ndcXOffset=projectionMatrix*modelViewMatrix*xOffsetWorld;vec2 xOffsetScreen=ndcToScreen(ndcXOffset/ndcXOffset.w);vec4 ndcYOffset=projectionMatrix*modelViewMatrix*yOffsetWorld;vec2 yOffsetScreen=ndcToScreen(ndcYOffset/ndcYOffset.w);vec2 xAxisScreen=normalize(xOffsetScreen-tipScreen);vec2 yAxisScreen=normalize(yOffsetScreen-tipScreen);float padding=aaPaddingPx+outline;scaledWidthHeightPx=scaleByZoom();float halfWidth=scaledWidthHeightPx.x/2.+padding;float quadHeight=scaledWidthHeightPx.y+padding*2.;vec2 vertexScreen=(tipScreen+yAxisScreen*tipPaddingPx)+xAxisScreen*halfWidth*offset.x+yAxisScreen*quadHeight*offset.y;vec2 ndcVert=screenToNdc(vertexScreen);vOffsetPx=vec2(offset.x*halfWidth,offset.y*quadHeight);gl_Position=vec4(ndcVert*ndcTip.w,ndcTip.z,ndcTip.w);}"},72292:t=>{t.exports="precision highp float;uniform float opacity;uniform float centerSpacing;uniform float radius;uniform vec3 color;void main(){vec2 center=mod(gl_FragCoord.xy,vec2(centerSpacing))-vec2(centerSpacing*0.5);float polkaDot=1.-smoothstep(radius-(radius*0.2),radius,length(center));gl_FragColor=vec4(color,opacity*polkaDot);}"},47706:t=>{t.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;void main(){gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},73293:t=>{t.exports="#define ANTIALIAS_WIDTH  1.0\nprecision highp float;uniform vec3 outlineColor;uniform vec3 baseColor;uniform float radius;uniform float opacity;uniform float outlinePct;varying vec3 vPosition;void main(){float fragRadius=length(vPosition.xz);float outlineRadius=radius*outlinePct;float smoothAmt=fwidth(fragRadius)*ANTIALIAS_WIDTH;float mixAmt=smoothstep(outlineRadius-smoothAmt,outlineRadius,fragRadius);gl_FragColor=vec4(mix(baseColor,outlineColor,mixAmt),1.);gl_FragColor.a=opacity*(1.-smoothstep(radius-smoothAmt,radius,fragRadius));}"},67498:t=>{t.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},14536:t=>{t.exports="precision highp float;uniform vec3 baseColor;uniform float isDoor;varying vec3 vPosition;void main(){const float lineWidth=0.15;if(isDoor>0.){const float startZ=0.15;const float endZ=startZ+lineWidth;float alpha=(abs(vPosition.z)>startZ&&abs(vPosition.z)<endZ)?1.:0.;gl_FragColor=vec4(baseColor,alpha);}else{float alpha=(abs(vPosition.z)<lineWidth*0.5)?1.:0.;gl_FragColor=vec4(baseColor,alpha);}}"},86242:t=>{t.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;varying vec3 vPosition;void main(){vPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},93670:t=>{t.exports="#define ANTIALIAS_WIDTH  1.0\nprecision highp float;uniform float selectedWidth;uniform vec3 outlineColor;uniform vec3 color;uniform float opacity;uniform float width;uniform vec3 lineStart;uniform vec3 lineEnd;varying vec3 vWorldPos;float distanceBetween(vec2 l1,vec2 l2,vec2 p){float D=length(l2-l1);float N=abs((l2.x-l1.x)*(l1.y-p.y)-(l1.x-p.x)*(l2.y-l1.y));return N/D;}void main(){float distanceToLine=distanceBetween(lineStart.xz,lineEnd.xz,vWorldPos.xz);float aaWidth=fwidth(distanceToLine)*ANTIALIAS_WIDTH;float lineLerp=smoothstep(selectedWidth-aaWidth,selectedWidth,distanceToLine);float halfWidth=width*0.5;float aaOpacity=smoothstep(halfWidth,halfWidth-aaWidth,distanceToLine);gl_FragColor=mix(vec4(outlineColor,opacity*aaOpacity),vec4(color,opacity*aaOpacity),lineLerp);if(gl_FragColor.a<0.01){discard;}}"},40134:t=>{t.exports="precision highp float;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;attribute vec3 position;varying vec3 vWorldPos;void main(){vWorldPos=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"}}]);